:root{
    --bg:#0f1220; --card:#161a2a; --muted:#8a90a6; --text:#e8ecff; --accent:#7c9cff; --ok:#23c55e; --bad:#ef4444; --line:#252a40; --chip:#232842; --chip-2:#1e243d; --radius:14px;
  }
  body[data-theme="light"]{
    --bg:#f6f7fb; --card:#ffffff; --muted:#6b7280; --text:#0f172a; --accent:#3b82f6; --ok:#16a34a; --bad:#dc2626; --line:#e5e7eb; --chip:#f1f5f9; --chip-2:#e2e8f0;
  }
  *{box-sizing:border-box} html,body{height:100%}
  body{margin:0; font-family:Inter,ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto; background:var(--bg); color:var(--text);}
  
  /* Capçalera */
  .app-header{position:sticky; top:0; z-index:5; backdrop-filter: blur(8px); background:color-mix(in oklab, var(--bg) 75%, transparent); border-bottom:1px solid var(--line);}
  .wrap{max-width:1100px; margin:0 auto; padding:16px 24px}
  .row{display:flex; gap:12px; flex-wrap:wrap; align-items:center}
  .row > *{flex:1}
  .brand{display:flex; align-items:center; gap:10px; font-weight:700}
  .brand .dot{width:10px;height:10px;border-radius:50%; background:var(--accent); box-shadow:0 0 0 6px color-mix(in oklab, var(--accent) 30%, transparent)}
  
  .summary{display:flex; align-items:center; gap:10px; justify-content:flex-end}
  .summary .label{font-weight:800; letter-spacing:.3px; text-transform:uppercase; padding:4px 8px; border-radius:999px; border:1px solid var(--line)}
  .summary .label.profit{background:color-mix(in oklab, var(--ok) 18%, transparent); color:color-mix(in oklab, var(--ok) 90%, white); border-color:color-mix(in oklab, var(--ok) 35%, transparent)}
  .summary .label.loss{background:color-mix(in oklab, var(--bad) 15%, transparent); color:color-mix(in oklab, var(--bad) 90%, white); border-color:color-mix(in oklab, var(--bad) 35%, transparent)}
  .summary .amount{font-size:1.2rem; font-weight:800}
  
  .btn{background:var(--accent); color:white; border:none; padding:10px 14px; border-radius:12px; font-weight:700; cursor:pointer}
  .btn.ghost{background:transparent; color:inherit; border:1px solid var(--line)}
  .btn.bad{background:var(--bad); color:white}
  .btn.tiny{padding:6px 8px; border-radius:10px}
  .btn.icon{width:34px; height:34px; padding:0; display:inline-flex; align-items:center; justify-content:center; border-radius:999px}
  
  .select, .input{width:100%; background:var(--chip); border:1px solid var(--line); color:var(--text); padding:8px 10px; border-radius:10px}
  .small{font-size:.86rem} .muted{color:var(--muted)} .mono{font-variant-numeric:tabular-nums}
  .section-title{margin:0 0 6px 0}
  .card{background:var(--card); border:1px solid var(--line); border-radius:var(--radius); padding:12px}
  .card.compact{padding:10px}
  .kpis{display:grid; grid-template-columns:repeat(4,minmax(0,1fr)); gap:10px}
  .small-grid{grid-template-columns:repeat(4,minmax(0,1fr))}
  @media (max-width:900px){.kpis,.small-grid{grid-template-columns:repeat(2,1fr)}}
  @media (max-width:520px){.kpis,.small-grid{grid-template-columns:1fr}}
  .kpi h4{margin:0 0 4px 0; color:var(--muted); font-weight:600; font-size:.88rem}
  .kpi div{font-size:1.1rem; font-weight:700}
  .kpi .positive{color:var(--ok)}
  .kpi .negative{color:var(--bad)}
  
  /* Barra de paquets amb xips */
  .pkgbar{align-items:center}
  .actions{display:flex; gap:6px; justify-content:flex-end; flex-wrap:nowrap}
  .chips{display:flex; gap:8px; flex-wrap:wrap}
  .chip{display:inline-flex; align-items:center; gap:8px; padding:6px 10px; background:var(--chip); border:1px solid var(--line); border-radius:999px; cursor:pointer; user-select:none}
  .chip:hover{background:var(--chip-2)}
  .chip.active{outline:2px solid color-mix(in oklab, var(--accent) 65%, transparent)}
  .chip.add{background:transparent; border-style:dashed}

  /* Chip que és una barra de progrés */
.chip.pb{
  position: relative;
  overflow: hidden;
  padding: 6px 10px;
  display: inline-flex;
  align-items: center;
  gap: 8px;
}
.chip.pb .fill{
  position: absolute;
  inset: 0;
  width: var(--pct, 0%);
  background: color-mix(in oklab, var(--ok) 85%, transparent);
  opacity: .28; /* verd fosc suau que va pujant */
  pointer-events: none;
}
.chip.pb.win .fill{
  opacity: .35; /* una mica més marcat si ja supera 100% */
}
.chip.pb .txt{
  position: relative; /* sobre la capa de farcit */
  display: inline-flex;
  align-items: center;
  gap: 8px;
  white-space: nowrap;
}
.chip.pb .pkg-name{ font-weight: 700; }
.chip.pb .pct{
  font-size: .78rem;
  font-variant-numeric: tabular-nums;
  opacity: .9;
}
.chip.pb .dot{
  width: 8px; height: 8px; border-radius: 50%;
  background: var(--ok);
  opacity: .85;
}
.chip.pb .dot.neg{ background: var(--bad); }

  
  /* Capçalera de taula */
  .head-left{display:flex; align-items:center; gap:10px}
  
  /* Taula */
  .table-wrap{overflow:auto}
  #table{width:100%; border-collapse:separate; border-spacing:0 6px}
  #table thead th{color:var(--muted); font-weight:600; text-align:left; font-size:.86rem; cursor:pointer}
  #table.compact-table tbody td, #table.compact-table thead th{padding:8px 8px}
  #table tbody tr{background:var(--card); border:1px solid var(--line)}
  #table tbody tr td:first-child{border-top-left-radius:10px; border-bottom-left-radius:10px}
  #table tbody tr td:last-child{border-top-right-radius:10px; border-bottom-right-radius:10px}
  #table tbody tr.sold{background:color-mix(in oklab, var(--ok) 10%, var(--card)); border-color:color-mix(in oklab, var(--ok) 30%, var(--line))}
  .right{text-align:right}
  .editable{cursor:text}
  .pill{display:inline-flex; align-items:center; gap:6px; padding:4px 8px; border-radius:999px; font-size:.8rem; border:1px solid var(--line); background:var(--chip); cursor:pointer}
  .pill.ok{background:color-mix(in oklab, var(--ok) 12%, transparent); border-color:color-mix(in oklab, var(--ok) 30%, transparent)}
  .name-link{color:inherit; text-decoration:none; font-weight:600}
  .name-link:hover{text-decoration:underline}
  .footer-actions{display:flex; gap:8px; justify-content:flex-end; margin-top:10px}
  
  /* Editor inline */
  .cell-editor{width:100%}
  .cell-editor input{width:100%; padding:6px 8px; border-radius:8px; border:1px solid var(--line); background:var(--chip); color:var(--text); font:inherit}
  
  /* Modal */
  dialog{border:none; padding:0; border-radius:14px; max-width:560px; width:100%}
  dialog::backdrop{background:rgba(0,0,0,.55)}
  .modal{background:var(--card); border:1px solid var(--line); padding:14px; border-radius:14px}
  .grid{display:grid; grid-template-columns:1fr 1fr; gap:10px}
  @media (max-width:520px){.grid{grid-template-columns:1fr}}
  
  .wrap > .card { margin: 14px 0 0; }
  .wrap > .card:first-of-type { margin-top: 0; }

  /* 1) Text blanc als xips */
.chip{ color: var(--text); }

/* 2) Més espai sota el label de descompte/enviament */
#pkgDiscount, #pkgShipping { margin-top: 6px; }
/* Modal: text i botons en el color de tema (blanc en tema fosc) */
dialog .modal { color: var(--text); }
dialog .modal h3 { color: var(--text); }
dialog .modal .btn.ghost { color: var(--text); }

/* Editor inline: mateix tamany que la cel·la, sense moure files */
/* Cel·les editables i editor “overlay” del mateix tamany */
/* La cel·la no canvia mida al editar */
#table td.editable { position: relative; }

/* Overlay exactament de la mateixa mida; sense borde ni padding */
.cell-editor{
  position: absolute;
  inset: 0;
  display: flex;
  align-items: center;      /* verticalment centrada com el text normal */
  background: transparent;  /* sense cap “capsa clara” */
  border: 0;
  padding: 0;
  box-sizing: border-box;
}

/* L'input ocupa tota la cel·la i hereta l'alineació */
.cell-editor input{
  width: 100%;
  height: 100%;
  margin: 0;
  padding: 0;               /* no afegeix alçada extra */
  border: 0;
  outline: none;
  background: transparent;
  color: var(--text);
  font: inherit;
  text-align: inherit;      /* hereta .right si la cel·la és numèrica */
  line-height: inherit;     /* evita que l'alçada salti */
}

/* Marca visual de "estic editant" sense canviar la mida (outline no ocupa espai) */
#table td.editing .cell-editor { outline: 1px dashed var(--line); outline-offset: -1px; border-radius: 8px; }

/* Si vols assegurar l'alineació dreta en numèrics, per si algun navegador no hereta bé */
#table td.right .cell-editor input { text-align: right; }

.cell-editor input[type="number"]::-webkit-outer-spin-button,
.cell-editor input[type="number"]::-webkit-inner-spin-button{
  -webkit-appearance: none;
  margin: 0;
}
.cell-editor input[type="number"]{
  -moz-appearance: textfield; /* Firefox */
}

/* Benefici/Pèrdua sota el títol del paquet */
/* Títol + benefici/pèrdua a la dreta */
.pkg-header{
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:12px;
    margin-bottom:6px; /* lleu separació amb els KPIs */
  }
  .pkg-profit{
    display:flex;
    align-items:center;
    gap:10px;
  }
  .pkg-profit .badge{
    padding:2px 10px;
    border-radius:999px;
    font-weight:600;
    font-size:.85rem;
    border:1px solid var(--line);
    background: var(--card);
  }
  .pkg-profit .badge.profit{ color: var(--ok); }
  .pkg-profit .badge.loss{   color: var(--bad); }
  .pkg-profit .amount{ font-variant-numeric: tabular-nums; }
  
  /* Opcional: quan la pantalla és estreta, que el badge baixi a sota per no fer scroll horitzontal */
  @media (max-width: 560px){
    .pkg-header{ flex-direction:column; align-items:flex-start; gap:6px; }
  }
  
/* —— Capçalera “només logo” + resum centrat en mòbil —— */
@media (max-width: 560px){
  .app-header .wrap{
    position: relative;
    height: 56px;         /* en lloc de només min-height */
    padding: 8px 12px;
    display: block;       /* com ja tenies */
  }
  /* Brand: només el punt blau, fixat a l’esquerra */
  .app-header .brand {
    position: absolute;
    left: 12px;
    top: 50%;
    transform: translateY(-50%);
    display: inline-flex;
    align-items: center;
    gap: 8px;
  }
  .app-header .brand .brand-title { display: none; }  /* amaga el text */

  /* El "punt" (per si cal assegurar mides) */
  .app-header .brand .dot {
    width: 14px; height: 14px; border-radius: 50%;
    background: var(--accent);
    display: inline-block;
  }

  /* Resum centrat al mig */
  #summaryBox.summary{
    position: absolute;
    left: 50%;
    top: 50%;
    transform: translate(-50%, -50%); /* centre real en dues direccions */
    margin: 0;
    display: inline-flex;             /* conserva el layout intern */
    align-items: center;
    justify-content: center;
    white-space: nowrap;              /* evita que salti de línia */
  }
}

